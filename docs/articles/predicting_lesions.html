<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Predicting Lesions with FLEXCONN â€¢ flexconn</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Predicting Lesions with FLEXCONN">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexconn</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.4.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/predicting_lesions.html">Predicting Lesions with FLEXCONN</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/muschellij2/flexconn">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="predicting_lesions_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Predicting Lesions with FLEXCONN</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/muschellij2/flexconn/blob/master/vignettes/predicting_lesions.Rmd"><code>vignettes/predicting_lesions.Rmd</code></a></small>
      <div class="hidden name"><code>predicting_lesions.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(neurobase)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#&gt; Loading required package: oro.nifti</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; oro.nifti 0.10.2</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(flexconn)</span></code></pre></div>
<div id="installing-flexconn" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-flexconn" class="anchor"></a>Installing FLEXCONN</h2>
<p>FLEXCONN stands for Fast Lesion Extraction using Convolutional Neural Networks, which the main goal is to segment lesions from magnetic resonance images (MRIs) from patients with multiple sclerosis (MS). The methods are described here: <a href="https://arxiv.org/abs/1803.09172" class="uri">https://arxiv.org/abs/1803.09172</a>. Patients with MS commonly have 2 MRI sequences done, T1-weighted images and fluid attenuated inversion recovery (FLAIR). FLEXCONN requires a number of Python modules to run. You can install them either system wide (not shown) or using <code>reticulate</code>. The <code>reticulate</code> way is wrapped in <code>install_flexconn</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>flexconn<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/flexconn/man/install_flexconn.html">install_flexconn</a></span>()</span></code></pre></div>
</div>
<div id="downloading-a-model" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-a-model" class="anchor"></a>Downloading a Model</h2>
<p>Here we download one of the fit models from FLEXCONN 1.1 (<a href="https://www.nitrc.org/projects/flexconn/" class="uri">https://www.nitrc.org/projects/flexconn/</a>), which is from one reader, a <code>35x35</code> patch size (2D model) and it was fit using 21 atlases.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>model_file =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>(<span class="dt">fileext =</span> <span class="st">".h5"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>base_url =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="st">"https://github.com/muschellij2/flexconnr"</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="st">"/raw/master/inst/extdata/"</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a>model_url =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>  base_url, <span class="st">"21atlases/"</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="st">"atlas_with_mask1/FLEXCONNmodel2D_35x35_17-10-2017_21-53-35.h5"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(model_url, <span class="dt">destfile =</span> model_file)</span></code></pre></div>
<p>We will load the model into <code>R</code> so we can predict using it</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>model =<span class="st"> </span>keras<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/keras/man/save_model_hdf5.html">load_model_hdf5</a></span>(model_file)</span>
<span id="cb4-2"><a href="#cb4-2"></a>model</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; Model</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt; Model: "model_1"</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; Layer (type)              Output Shape      Param #  Connected to               </span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; ================================================================================</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; input_1 (InputLayer)      [(None, None, Non 0                                   </span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; input_2 (InputLayer)      [(None, None, Non 0                                   </span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; conv2d_1 (Conv2D)         (None, None, None 1280     input_1[0][0]              </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; conv2d_6 (Conv2D)         (None, None, None 1280     input_2[0][0]              </span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; conv2d_2 (Conv2D)         (None, None, None 204864   conv2d_1[0][0]             </span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; conv2d_7 (Conv2D)         (None, None, None 204864   conv2d_6[0][0]             </span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; conv2d_3 (Conv2D)         (None, None, None 18464    conv2d_2[0][0]             </span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; conv2d_8 (Conv2D)         (None, None, None 18464    conv2d_7[0][0]             </span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt; conv2d_4 (Conv2D)         (None, None, None 12816    conv2d_3[0][0]             </span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="co">#&gt; conv2d_9 (Conv2D)         (None, None, None 12816    conv2d_8[0][0]             </span></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="co">#&gt; conv2d_5 (Conv2D)         (None, None, None 1160     conv2d_4[0][0]             </span></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">#&gt; conv2d_10 (Conv2D)        (None, None, None 1160     conv2d_9[0][0]             </span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co">#&gt; concatenate_1 (Concatenat (None, None, None 0        conv2d_5[0][0]             </span></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="co">#&gt;                                                      conv2d_10[0][0]            </span></span>
<span id="cb4-34"><a href="#cb4-34"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-35"><a href="#cb4-35"></a><span class="co">#&gt; conv2d_11 (Conv2D)        (None, None, None 18560    concatenate_1[0][0]        </span></span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="co">#&gt; conv2d_12 (Conv2D)        (None, None, None 204864   conv2d_11[0][0]            </span></span>
<span id="cb4-38"><a href="#cb4-38"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-39"><a href="#cb4-39"></a><span class="co">#&gt; conv2d_13 (Conv2D)        (None, None, None 18464    conv2d_12[0][0]            </span></span>
<span id="cb4-40"><a href="#cb4-40"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-41"><a href="#cb4-41"></a><span class="co">#&gt; conv2d_14 (Conv2D)        (None, None, None 12816    conv2d_13[0][0]            </span></span>
<span id="cb4-42"><a href="#cb4-42"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-43"><a href="#cb4-43"></a><span class="co">#&gt; conv2d_15 (Conv2D)        (None, None, None 1160     conv2d_14[0][0]            </span></span>
<span id="cb4-44"><a href="#cb4-44"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb4-45"><a href="#cb4-45"></a><span class="co">#&gt; conv2d_16 (Conv2D)        (None, None, None 73       conv2d_15[0][0]            </span></span>
<span id="cb4-46"><a href="#cb4-46"></a><span class="co">#&gt; ================================================================================</span></span>
<span id="cb4-47"><a href="#cb4-47"></a><span class="co">#&gt; Total params: 733,105</span></span>
<span id="cb4-48"><a href="#cb4-48"></a><span class="co">#&gt; Trainable params: 733,105</span></span>
<span id="cb4-49"><a href="#cb4-49"></a><span class="co">#&gt; Non-trainable params: 0</span></span>
<span id="cb4-50"><a href="#cb4-50"></a><span class="co">#&gt; ________________________________________________________________________________</span></span></code></pre></div>
</div>
<div id="downloading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-data" class="anchor"></a>Downloading Data</h2>
<p>Again, we need a T1-weighted and FLAIR image to do prediction. We use some example data here from the package and plot each one. The <code>gt</code> object is the ground truth, manual segmentation:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>t1_file =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"MPRAGE.nii.gz"</span>, <span class="dt">package =</span> <span class="st">"flexconn"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>t1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/readNIfTI2.html">readnii</a></span>(t1_file)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/ortho2.html">ortho2</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/robust_window.html">robust_window</a></span>(t1))</span></code></pre></div>
<p><img src="predicting_lesions_files/figure-html/dl_data-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a></span>
<span id="cb6-2"><a href="#cb6-2"></a>flair_file =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"FLAIR.nii.gz"</span>, <span class="dt">package =</span> <span class="st">"flexconn"</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>flair =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/readNIfTI2.html">readnii</a></span>(flair_file)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/ortho2.html">ortho2</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/robust_window.html">robust_window</a></span>(flair))</span></code></pre></div>
<p><img src="predicting_lesions_files/figure-html/dl_data-2.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a></span>
<span id="cb7-2"><a href="#cb7-2"></a>gt_file =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"MPRAGE_manual.nii.gz"</span>, <span class="dt">package =</span> <span class="st">"flexconn"</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>gt =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/readNIfTI2.html">readnii</a></span>(gt_file)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/ortho2.html">ortho2</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/robust_window.html">robust_window</a></span>(flair), gt, <span class="dt">xyz =</span> <span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/xyz.html">xyz</a></span>(gt))</span></code></pre></div>
<p><img src="predicting_lesions_files/figure-html/dl_data-3.png" width="700"></p>
</div>
<div id="predicting-lesions" class="section level2">
<h2 class="hasAnchor">
<a href="#predicting-lesions" class="anchor"></a>Predicting Lesions</h2>
<p>Here we will predict using the pre-trained model and we</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>res =<span class="st"> </span><span class="kw"><a href="../reference/flexconn_predict.html">flexconn_predict</a></span>(model,</span>
<span id="cb8-2"><a href="#cb8-2"></a>                       <span class="dt">t1 =</span> t1_file,</span>
<span id="cb8-3"><a href="#cb8-3"></a>                       <span class="dt">flair =</span> flair_file)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt; Normalizing Images</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; 99th quantile is 1136581.056, bandwidth =14207.263, gridsize =80</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; 4 peaks found.</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; Peak found at 1044512.47383877 for T1</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; 99th quantile is 34706.499, bandwidth =433.831, gridsize =80</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; 5 peaks found.</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt; Peak found at 28277.7755924928 for FL</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; Predicting from model</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; ================================================================================</span></span></code></pre></div>
<p>Here we overlay the probabilities on the FLAIR image:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>col.y =<span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#010000"</span>, <span class="st">"#0C0000"</span>, <span class="st">"#170000"</span>, <span class="st">"#210000"</span>, <span class="st">"#2C0000"</span>,</span>
<span id="cb9-2"><a href="#cb9-2"></a>            <span class="st">"#360000"</span>, <span class="st">"#410000"</span>, <span class="st">"#4C0000"</span>, <span class="st">"#560000"</span>, <span class="st">"#610000"</span>,</span>
<span id="cb9-3"><a href="#cb9-3"></a>            <span class="st">"#6C0000"</span>, <span class="st">"#760000"</span>, <span class="st">"#810000"</span>, <span class="st">"#8B0000"</span>, <span class="st">"#960000"</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>            <span class="st">"#A10000"</span>, <span class="st">"#AB0000"</span>, <span class="st">"#B60000"</span>, <span class="st">"#C10000"</span>, <span class="st">"#CB0000"</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>            <span class="st">"#D60000"</span>, <span class="st">"#E00000"</span>, <span class="st">"#EB0000"</span>, <span class="st">"#F60000"</span>, <span class="st">"#FF0100"</span>,</span>
<span id="cb9-6"><a href="#cb9-6"></a>            <span class="st">"#FF0C00"</span>, <span class="st">"#FF1700"</span>, <span class="st">"#FF2100"</span>, <span class="st">"#FF2C00"</span>, <span class="st">"#FF3600"</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>            <span class="st">"#FF4100"</span>, <span class="st">"#FF4C00"</span>, <span class="st">"#FF5600"</span>, <span class="st">"#FF6100"</span>, <span class="st">"#FF6C00"</span>,</span>
<span id="cb9-8"><a href="#cb9-8"></a>            <span class="st">"#FF7600"</span>, <span class="st">"#FF8100"</span>, <span class="st">"#FF8B00"</span>, <span class="st">"#FF9600"</span>, <span class="st">"#FFA100"</span>,</span>
<span id="cb9-9"><a href="#cb9-9"></a>            <span class="st">"#FFAB00"</span>, <span class="st">"#FFB600"</span>, <span class="st">"#FFC100"</span>, <span class="st">"#FFCB00"</span>, <span class="st">"#FFD600"</span>,</span>
<span id="cb9-10"><a href="#cb9-10"></a>            <span class="st">"#FFE000"</span>, <span class="st">"#FFEB00"</span>, <span class="st">"#FFF600"</span>, <span class="st">"#FFFF02"</span>, <span class="st">"#FFFF12"</span>,</span>
<span id="cb9-11"><a href="#cb9-11"></a>            <span class="st">"#FFFF22"</span>, <span class="st">"#FFFF32"</span>, <span class="st">"#FFFF42"</span>, <span class="st">"#FFFF52"</span>, <span class="st">"#FFFF62"</span>,</span>
<span id="cb9-12"><a href="#cb9-12"></a>            <span class="st">"#FFFF72"</span>, <span class="st">"#FFFF81"</span>, <span class="st">"#FFFF91"</span>, <span class="st">"#FFFFA1"</span>, <span class="st">"#FFFFB1"</span>,</span>
<span id="cb9-13"><a href="#cb9-13"></a>            <span class="st">"#FFFFC1"</span>, <span class="st">"#FFFFD1"</span>, <span class="st">"#FFFFE1"</span>, <span class="st">"#FFFFF1"</span>)</span>
<span id="cb9-14"><a href="#cb9-14"></a>col.y =<span class="st"> </span>grDevices<span class="op">::</span><span class="kw"><a href="https://rdrr.io/r/grDevices/col2rgb.html">col2rgb</a></span>(col.y, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb9-15"><a href="#cb9-15"></a>col.y =<span class="st"> </span>grDevices<span class="op">::</span><span class="kw"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(col.y[<span class="dv">1</span>,], col.y[<span class="dv">2</span>,], col.y[<span class="dv">3</span>,], col.y[<span class="dv">4</span>,], <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/ortho2.html">ortho2</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/robust_window.html">robust_window</a></span>(flair), res, <span class="dt">col.y =</span> col.y)</span></code></pre></div>
<p><img src="predicting_lesions_files/figure-html/plot_result-1.png" width="700"></p>
<p>Here we see we have a probability map of lesions. To get a binary mask, we can use the <code>remove_small_components</code>, which thresholds the image and removes voxels with fewer than 27 connected voxels:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>pred =<span class="st"> </span><span class="kw"><a href="../reference/remove_small_components.html">remove_small_components</a></span>(res)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/ortho2.html">ortho2</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/robust_window.html">robust_window</a></span>(flair), pred, <span class="dt">xyz =</span> <span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/xyz.html">xyz</a></span>(pred), <span class="dt">col.y =</span> <span class="st">"#FF000080"</span>)</span></code></pre></div>
<p><img src="predicting_lesions_files/figure-html/plot_binary-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>neurobase<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/fast_dice_tab.html">fast_dice</a></span>(pred, gt)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">#&gt; [1] 0.2118038</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#installing-flexconn">Installing FLEXCONN</a></li>
      <li><a href="#downloading-a-model">Downloading a Model</a></li>
      <li><a href="#downloading-data">Downloading Data</a></li>
      <li><a href="#predicting-lesions">Predicting Lesions</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Muschelli, Sigrid Keydana.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
